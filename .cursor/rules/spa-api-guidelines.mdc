
# SPA Sentirse Bien - MigraciÃ³n y Desarrollo TP-2025

Eres un Senior Full-Stack Developer especializado en **migraciÃ³n de APIs Node.js hacia .NET Core** y **desarrollo ASP.NET MVC**. Experto en transformar arquitecturas JavaScript/TypeScript a C# manteniendo funcionalidad completa y cumpliendo requisitos acadÃ©micos especÃ­ficos.

## Contexto del Proyecto: TP Integrador 2025

### âœ… **ESTADO ACTUAL**
- **Frontend SPA**: Next.js 15 + React 18 **COMPLETO Y FUNCIONANDO**
- **Backend Node.js**: Express + TypeScript + MongoDB **TOTALMENTE IMPLEMENTADO**
- **Objetivo**: Migrar a .NET manteniendo compatibilidad con frontend existente

### ğŸ¯ **REQUISITOS TP-2025 A CUMPLIR**

#### **Componentes Obligatorios**
1. **ASP.NET MVC App** - GestiÃ³n administrativa (NUEVO)
2. **ASP.NET Core Web API** - MigraciÃ³n de Node.js (MIGRAR)
3. **SPA Next.js** - Cliente final (YA EXISTE)

#### **Requerimientos TÃ©cnicos EspecÃ­ficos**
âœ… **AutenticaciÃ³n JWT** con endpoints protegidos  
âœ… **Registro usuarios** con validaciÃ³n completa  
âœ… **Passwords hasheadas** con salt (BCrypt)  
âœ… **RecuperaciÃ³n contraseÃ±as** con enlaces Ãºnicos temporales  
âœ… **Listados paginados** en todos los mÃ³dulos  
âœ… **Vistas detalle** de elementos especÃ­ficos  
âœ… **CRUD con dropdown/selector** (roles, categorÃ­as)  
âœ… **EdiciÃ³n elementos** existentes  
âœ… **CÃ³digos QR dinÃ¡micos** generados desde .NET  
âœ… **Enlaces QR temporales** con expiraciÃ³n (10-60 min)  
âœ… **Funcionalidad exclusiva QR** accesible solo via cÃ³digo  

## AnÃ¡lisis del Sistema Existente Node.js

### **Estructura Backend Actual**
```
spa-sentirse-bien-backend/
â”œâ”€â”€ server.ts              # Express + middleware auth JWT
â”œâ”€â”€ config/db.ts           # MongoDB + Mongoose
â”œâ”€â”€ users/                 # MÃ³dulo usuarios completo
â”‚   â”œâ”€â”€ model.ts          # Schema: first_name, last_name, email, password, role, is_admin
â”‚   â”œâ”€â”€ controller.ts     # LÃ³gica CRUD + auth
â”‚   â”œâ”€â”€ service.ts        # Business logic
â”‚   â”œâ”€â”€ dao.ts            # Data access
â”‚   â””â”€â”€ routes.ts         # Express routes
â”œâ”€â”€ services/              # MÃ³dulo servicios spa
â”‚   â”œâ”€â”€ model.ts          # Schema: nombre, Image, tipo, precio, descripcion
â”‚   â””â”€â”€ [controller, service, dao, routes]
â”œâ”€â”€ turnos/                # Sistema reservas/citas
â”œâ”€â”€ payments/              # Procesamiento pagos
â””â”€â”€ utils/
    â”œâ”€â”€ mailer.ts         # Nodemailer + OAuth2 Gmail
    â””â”€â”€ resendMailer.ts   # Resend service
```

### **Funcionalidades Implementadas Node.js**
âœ… **AutenticaciÃ³n JWT completa** con middleware personalizado  
âœ… **Roles**: cliente, admin, profesional  
âœ… **Hash passwords** con bcrypt (salt 10)  
âœ… **CRUD Usuarios**: registro, login, perfil  
âœ… **CRUD Servicios**: nombre, imagen, tipo, precio, descripciÃ³n  
âœ… **Sistema Turnos**: reservas con profesionales  
âœ… **Procesamiento Pagos**: transacciones y recibos  
âœ… **Email service**: Gmail OAuth2 + Resend  
âœ… **CORS configurado** para frontend  
âœ… **Middleware centralizado** de errores  

### **Frontend Next.js Existente**
âœ… **Next.js 15** + React 18 + TypeScript  
âœ… **Radix UI** components (dropdown, dialog, etc.)  
âœ… **TailwindCSS** + Framer Motion  
âœ… **React Hook Form** + Zod validation  
âœ… **React Query** para state management  
âœ… **JWT handling** con jwt-decode  
âœ… **Firebase** + NextAuth integration  
âœ… **Responsive design** completo  

## Plan de MigraciÃ³n Node.js â†’ .NET

### **Mapeo TecnolÃ³gico**
```
NODE.JS STACK                    â†’  .NET STACK
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Express.js + TypeScript          â†’  ASP.NET Core Web API + C#
Mongoose ODM                     â†’  MongoDB.Driver + Models
jsonwebtoken                     â†’  Microsoft.AspNetCore.Authentication.JwtBearer
bcrypt                          â†’  BCrypt.Net-Next
nodemailer + googleapis         â†’  MailKit + MimeKit
express.Router()                â†’  [ApiController] classes
Custom middleware               â†’  ASP.NET Core Middleware pipeline
CORS package                    â†’  Built-in services.AddCors()
```

### **Mapeo ArquitectÃ³nico**
```
NODE.JS STRUCTURE                â†’  ASP.NET STRUCTURE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
server.ts                       â†’  Program.cs + Startup
config/db.ts                    â†’  Services/MongoDbService.cs
users/model.ts                  â†’  Models/Entities/User.cs
users/controller.ts             â†’  Controllers/UsersController.cs
users/service.ts                â†’  Services/UserService.cs
users/dao.ts                    â†’  Repositories/UserRepository.cs
utils/mailer.ts                 â†’  Services/EmailService.cs
middleware auth                 â†’  [Authorize] attributes + JWT middleware
```

## Arquitectura Objetivo .NET

### **Proyecto 1: ASP.NET Core Web API**
```
SpaApi/
â”œâ”€â”€ Controllers/
â”‚   â”œâ”€â”€ AuthController.cs      # Login, register, password recovery
â”‚   â”œâ”€â”€ UsersController.cs     # CRUD usuarios + roles
â”‚   â”œâ”€â”€ ServicesController.cs  # CRUD servicios spa
â”‚   â”œâ”€â”€ AppointmentsController.cs # Sistema turnos
â”‚   â”œâ”€â”€ PaymentsController.cs  # Procesamiento pagos
â”‚   â””â”€â”€ QRController.cs        # GeneraciÃ³n QR + enlaces temporales
â”œâ”€â”€ Models/
â”‚   â”œâ”€â”€ Entities/              # MongoDB entities
â”‚   â”‚   â”œâ”€â”€ User.cs           # Migrar de users/model.ts
â”‚   â”‚   â”œâ”€â”€ Service.cs        # Migrar de services/model.ts
â”‚   â”‚   â”œâ”€â”€ Appointment.cs    # Migrar de turnos/model.ts
â”‚   â”‚   â””â”€â”€ Payment.cs        # Migrar de payments/model.ts
â”‚   â””â”€â”€ DTOs/                 # Request/Response objects
â”œâ”€â”€ Services/
â”‚   â”œâ”€â”€ AuthService.cs        # JWT + BCrypt
â”‚   â”œâ”€â”€ UserService.cs        # Business logic usuarios
â”‚   â”œâ”€â”€ EmailService.cs       # MailKit integration
â”‚   â””â”€â”€ QRService.cs          # QR generation + validation
â”œâ”€â”€ Repositories/
â”‚   â”œâ”€â”€ UserRepository.cs     # MongoDB data access
â”‚   â””â”€â”€ ServiceRepository.cs  # Data layer
â”œâ”€â”€ Middleware/
â”‚   â””â”€â”€ JwtAuthMiddleware.cs  # Custom JWT validation
â””â”€â”€ Program.cs                # Configuration + DI
```

### **Proyecto 2: ASP.NET MVC Admin**
```
SpaMvc/
â”œâ”€â”€ Controllers/
â”‚   â”œâ”€â”€ HomeController.cs     # Dashboard
â”‚   â”œâ”€â”€ UsersController.cs    # GestiÃ³n usuarios con dropdown roles
â”‚   â””â”€â”€ ServicesController.cs # CRUD servicios con selector categorÃ­as
â”œâ”€â”€ Models/
â”‚   â””â”€â”€ ViewModels/           # Models for views
â”œâ”€â”€ Views/
â”‚   â”œâ”€â”€ Users/
â”‚   â”‚   â”œâ”€â”€ Index.cshtml     # Listado paginado
â”‚   â”‚   â”œâ”€â”€ Details.cshtml   # Vista detalle
â”‚   â”‚   â””â”€â”€ Edit.cshtml      # Formulario con dropdown
â”‚   â””â”€â”€ Services/
â”‚       â”œâ”€â”€ Index.cshtml     # Listado con paginaciÃ³n
â”‚       â”œâ”€â”€ Create.cshtml    # Formulario con selector
â”‚       â””â”€â”€ Edit.cshtml      # EdiciÃ³n completa
â””â”€â”€ Program.cs               # MVC configuration
```

## ImplementaciÃ³n EspecÃ­fica por MÃ³dulos

### **1. Sistema de AutenticaciÃ³n JWT**
```csharp
// AuthController.cs - Migrar de users/controller.ts
[ApiController]
[Route("api/[controller]")]
public class AuthController : ControllerBase
{
    [HttpPost("login")]
    public async Task<IActionResult> Login(LoginDto request)
    {
        // Migrar lÃ³gica de users/service.ts
        // BCrypt validation + JWT generation
    }
    
    [HttpPost("register")]
    public async Task<IActionResult> Register(RegisterDto request)
    {
        // Migrar registration logic
        // BCrypt hash + save to MongoDB
    }
    
    [HttpPost("forgot-password")]
    public async Task<IActionResult> ForgotPassword(string email)
    {
        // Generar token temporal + email recovery
    }
}
```

### **2. Modelo Usuario (MigraciÃ³n Directa)**
```csharp
// Models/Entities/User.cs - Migrar de users/model.ts
public class User
{
    [BsonId]
    [BsonRepresentation(BsonType.ObjectId)]
    public string Id { get; set; }
    
    [Required]
    public string FirstName { get; set; } // first_name
    
    [Required]
    public string LastName { get; set; }  // last_name

    [Required]
    [EmailAddress]
    public string Email { get; set; }
    
    [Required]
    public string Password { get; set; } // BCrypt hashed
    
    [Required]
    public string Role { get; set; } // cliente, admin, profesional
    
    public bool IsAdmin { get; set; } = false; // is_admin
}
```

### **3. Sistema QR DinÃ¡mico (Requisito TP-2025)**
```csharp
// Controllers/QRController.cs
[ApiController]
[Route("api/[controller]")]
public class QRController : ControllerBase
{
    [HttpGet("generate/{serviceId}")]
    public async Task<IActionResult> GenerateQR(string serviceId)
    {
        // Generar hash temporal con expiraciÃ³n 30min
        var temporalHash = GenerateTemporalHash(serviceId);
        var qrLink = $"{_baseUrl}/api/qr/validate/{temporalHash}";
        
        // Generar QR image bytes
        var qrBytes = _qrService.GenerateQRCode(qrLink);
        return File(qrBytes, "image/png");
    }
    
    [HttpGet("validate/{hash}")]
    public async Task<IActionResult> ValidateQR(string hash)
    {
        // Validar hash temporal + ejecutar funcionalidad exclusiva
        // Ejemplo: descuento especial, acceso premium
    }
}
```

### **4. MVC con Dropdown (Requisito TP-2025)**
```html
<!-- Views/Users/Edit.cshtml -->
<form asp-action="Edit" method="post">
    <div class="form-group">
        <label asp-for="FirstName"></label>
        <input asp-for="FirstName" class="form-control" />
    </div>
    
    <div class="form-group">
        <label asp-for="Role">Rol de Usuario</label>
        <select asp-for="Role" class="form-control">
            <option value="cliente">Cliente</option>
            <option value="profesional">Profesional</option>
            <option value="admin">Administrador</option>
        </select>
    </div>
    
    <button type="submit" class="btn btn-primary">Guardar</button>
</form>
```

## ConfiguraciÃ³n MongoDB en .NET

### **ConexiÃ³n y ConfiguraciÃ³n**
```csharp
// Program.cs
builder.Services.Configure<MongoDbSettings>(
    builder.Configuration.GetSection("MongoDb"));

builder.Services.AddSingleton<IMongoClient>(serviceProvider =>
{
    var settings = serviceProvider.GetRequiredService<IOptions<MongoDbSettings>>().Value;
    return new MongoClient(settings.ConnectionString);
});

// Services/MongoDbService.cs
public class MongoDbService
{
    private readonly IMongoDatabase _database;
    
    public MongoDbService(IMongoClient mongoClient, IOptions<MongoDbSettings> settings)
    {
        _database = mongoClient.GetDatabase(settings.Value.DatabaseName);
    }
    
    public IMongoCollection<T> GetCollection<T>(string collectionName)
    {
        return _database.GetCollection<T>(collectionName);
    }
}
```

## Frontend Integration

### **ActualizaciÃ³n Next.js para .NET API**
```typescript
// Solo cambiar base URL en frontend existente
const API_BASE_URL = 'https://localhost:7001/api'; // Nueva API .NET

// Mantener todas las funcionalidades existentes:
// - AutenticaciÃ³n JWT (mismo formato)
// - CRUD operations (mismos endpoints)
// - Componentes React (sin cambios)
// - Estado management (React Query)
```

## EstÃ¡ndares de Desarrollo

### **Naming Conventions**
- **C# Classes**: PascalCase (UserService, PaymentController)
- **C# Properties**: PascalCase (FirstName, Email)
- **API Endpoints**: kebab-case (/api/users, /api/services)
- **Database Collections**: lowercase (users, services, appointments)

### **Error Handling**
```csharp
// Middleware/GlobalExceptionMiddleware.cs
public class GlobalExceptionMiddleware
{
    public async Task InvokeAsync(HttpContext context, RequestDelegate next)
    {
        try
        {
            await next(context);
        }
        catch (Exception ex)
        {
            await HandleExceptionAsync(context, ex);
        }
  }
}
```

### **Validation**
```csharp
// DTOs con DataAnnotations
public class RegisterDto
{
    [Required]
    [EmailAddress]
    public string Email { get; set; }
    
    [Required]
    [MinLength(6)]
    public string Password { get; set; }
    
    [Required]
    public string FirstName { get; set; }
}
```

## Cumplimiento Requisitos TP-2025

### **Checklist Obligatorio**
âœ… **3 Componentes**: MVC(.NET) + API(.NET) + SPA(Next.js)  
âœ… **JWT Authentication**: Migrado de Node.js a .NET  
âœ… **Password Security**: BCrypt con salt  
âœ… **Password Recovery**: Enlaces Ãºnicos temporales  
âœ… **CRUD Operations**: Todos los mÃ³dulos migrados  
âœ… **Listados Paginados**: Implementados en .NET  
âœ… **Dropdown/Selector**: Roles en MVC, categorÃ­as en servicios  
âœ… **QR DinÃ¡mico**: GeneraciÃ³n .NET + enlaces temporales  
âœ… **Funcionalidad Exclusiva QR**: ValidaciÃ³n y acceso especial  

### **Arquitectura Final**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Admin MVC     â”‚    â”‚   API .NET Core  â”‚    â”‚  Frontend SPA   â”‚
â”‚  (ASP.NET MVC)  â”‚â”€â”€â”€â”€â”‚  (Migrado Node)  â”‚â”€â”€â”€â”€â”‚  (Next.js KEEP) â”‚
â”‚   GestiÃ³n       â”‚    â”‚   MongoDB        â”‚    â”‚   Cliente       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                       â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                       â”‚   Database  â”‚
                       â”‚   MongoDB   â”‚ 
                       â”‚ (Compartida) â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **Entregables TP-2025**
1. **Repositorio GitHub**: 3 carpetas diferenciadas
2. **Scripts BD**: MongoDB initialization
3. **DocumentaciÃ³n**: README con instrucciones
4. **Video Demo**: Funcionalidades principales
5. **Informe**: Cumplimiento de cada requisito

## Prioridades de Desarrollo

### **Fase 1: ConfiguraciÃ³n (.NET)**
- Crear proyectos ASP.NET Core API + MVC
- Configurar MongoDB connections
- Setup JWT authentication

### **Fase 2: MigraciÃ³n Core**
- Users module (auth + CRUD)
- Services module (spa services)
- Basic MVC views

### **Fase 3: Funcionalidades Avanzadas**
- QR system implementation
- Email services migration
- Password recovery

### **Fase 4: Integration & Testing**
- Frontend API integration
- End-to-end testing
- Documentation + video

Â¡IMPORTANTE! El frontend Next.js existente se mantiene intacto, solo se actualizan las URLs de API para apuntar a la nueva API .NET Core.

- **Maintenance**: CÃ³digo mÃ¡s predecible y mantenible
- **Scaling**: Better horizontal scaling options

**Recordar**: Esta migraciÃ³n debe ser **transparente para usuarios finales**. El SPA frontend no debe requerir cambios. La API migrada debe ser **production-ready, segura y escalable**, manteniendo toda la funcionalidad existente mientras cumple con los requerimientos del TP Integrador 2025. **MongoDB se mantiene como base de datos, aprovechando su flexibilidad para documentos y TTL automÃ¡tico para cÃ³digos QR.**
